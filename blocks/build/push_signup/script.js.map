{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./blocks/src/push_signup/loader.js","webpack:///./blocks/src/push_signup/script.js"],"names":["window","Push_Category_Loader","icon_markup","message_markup","icon_elements","message_elements","last_status","in_progress","timeout","init","source_button","icon_container","message_container","dataset","notificationLoaderId","Math","round","random","querySelector","appendChild","create_wrapper","markup","data_loader_id","className","element","document","createElement","classList","add","length","innerHTML","start","source_element","hide_all","push","querySelectorAll","i","style","display","remove","elements","transition","opacity","end","status","clearTimeout","setTimeout","everything","set_message","message","set_result","obj","OneSignal","isPushNotificationsSupported","precheck_existing_tags","container_class","tags","getElementsByClassName","checkboxes","box","hasOwnProperty","value","checked","parseInt","isPushNotificationsEnabled","then","isEnabled","getTags","buttons","submit_event","event","target","container","contains","parentNode","data","sendTags","permission_timeout","Notification","requestPermission","permission","any_tag_subscribed","tag_checkbox","setSubscription","addEventListener"],"mappings":"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","file":"push_signup/script.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./blocks/src/push_signup/script.js\");\n","window.Push_Category_Loader = window.Push_Category_Loader || {\r\n\r\n    /**\r\n     * The markup for icons\r\n     */\r\n    icon_markup: '<div class=\"loader-wrapper\"><div class=\"circle-loader\" style=\"display:none\"><div class=\"checkmark draw\"></div><div class=\"block draw\"></div></div></div>',\r\n\r\n    /**\r\n     * The markup for message containers\r\n     */\r\n    message_markup: '<div class=\"permission-status-message\"></div>',\r\n\r\n    /**\r\n     * DOM elements that allready have an icon in them (for duplication checking so each element gets at most one icon)\r\n     */\r\n    icon_elements: [],\r\n    \r\n    /**\r\n     * DOM elements that already have a message in them (for duplciation checking so each element gets at most one message)\r\n     */\r\n    message_elements: [],\r\n\r\n    /**\r\n     * The last recorded status of notifications (for contextual messages that depend on whether the status has changed)\r\n     */\r\n    last_status: 0,\r\n\r\n    /**\r\n     * Array of loader IDs that are currently trying to get permission\r\n     */\r\n    in_progress: [],\r\n\r\n\r\n    timeout: null,\r\n\r\n\r\n    /**\r\n     * Add markup for icon and message to the specified containers, triggered by the specified source button\r\n     */\r\n    init: function (source_button, icon_container, message_container) {\r\n\r\n        // if this button doesn't have a notification ID, assign one\r\n        if ( ! source_button.dataset.notificationLoaderId) {\r\n            source_button.dataset.notificationLoaderId = Math.round(Math.random() * 1000000);\r\n        }\r\n\r\n        // add the icon if it's not already in the specified container\r\n        if ( ! icon_container.querySelector('.permission-status_loading-icon')) {\r\n            icon_container.appendChild (this.create_wrapper (this.icon_markup, source_button.dataset.notificationLoaderId, 'permission-status_loading-icon'));\r\n        }\r\n        \r\n        // add the message if it's not already in the specified container\r\n        if ( ! message_container.querySelector('.permission-status_message')) {\r\n            message_container.appendChild (this.create_wrapper (this.message_markup, source_button.dataset.notificationLoaderId, 'permission-status_message'));\r\n        }\r\n    },\r\n\r\n    \r\n    /**\r\n     * Create a wrapper element with a given loader ID and class\r\n     */\r\n    create_wrapper: function (markup, data_loader_id, className) {\r\n\r\n        // create the outer element\r\n        let element = document.createElement('div');\r\n        element.dataset.notificationLoaderId = data_loader_id;\r\n        element.classList.add('permission-status');\r\n\r\n        // add the custom class name\r\n        if (className.length) {\r\n            element.className = element.className + ' ' + className;\r\n        }\r\n\r\n        // set the markup inside\r\n        element.innerHTML = markup;\r\n\r\n        return element;\r\n    },\r\n\r\n    /**\r\n     * Start the permission checking process\r\n     */\r\n    start: function (source_element) {\r\n        // hide everything (to take care of existing messages)\r\n        this.hide_all();\r\n\r\n        // set the notification ID as 'in progress'\r\n        this.in_progress.push (source_element.dataset.notificationLoaderId);\r\n\r\n        // reset the icons\r\n        let icon_elements = document.querySelectorAll(\"[data-notification-loader-id='\" + source_element.dataset.notificationLoaderId + \"'].permission-status .circle-loader\");\r\n        for (let i = 0; i < icon_elements.length; i++) {\r\n            icon_elements[i].style.display = \"block\";\r\n            icon_elements[i].classList.remove('load-complete');\r\n            icon_elements[i].classList.remove('load-failed');\r\n        }\r\n\r\n        // show icons/messages for this id\r\n        let elements = document.querySelectorAll(\"[data-notification-loader-id='\" + source_element.dataset.notificationLoaderId + \"'].permission-status\");\r\n        for (let i = 0; i < elements.length; i++) {\r\n            elements[i].style.transition = 'none';\r\n            elements[i].style.opacity = 1;\r\n        }\r\n    },\r\n\r\n    \r\n    /**\r\n     * End the permission checking\r\n     * @param string status  \"success\" or \"failed\"\r\n     */\r\n    end: function (status) {\r\n        clearTimeout (this.timeout);\r\n\r\n        for (let i = 0; i < this.in_progress.length; i++) {\r\n            let element = document.querySelector(\"[data-notification-loader-id='\" + this.in_progress[i] + \"'].permission-status .circle-loader\");\r\n            if (element) {\r\n                element.classList.add('load-complete');\r\n                if (status == 'failed') {\r\n                    element.classList.add('load-failed');\r\n                }\r\n            }\r\n        }\r\n\r\n        this.timeout = setTimeout (this.hide_all, 8000);\r\n\r\n        this.in_progress = [];\r\n    },\r\n\r\n\r\n    hide_all: function () {\r\n        let everything = document.querySelectorAll('.timeout-status .permission-status');\r\n        for (let i = 0; i < everything.length; i++) {\r\n            everything[i].style.transition = 'opacity 1s';\r\n            everything[i].style.opacity = 0;\r\n        }\r\n    },\r\n\r\n\r\n    /**\r\n     * Set the message for any in progress status message areas\r\n     * @param string message \r\n     */\r\n    set_message: function (message) {\r\n        for (let i = 0; i < this.in_progress.length; i++) {\r\n            let element = document.querySelector(\"[data-notification-loader-id='\" + this.in_progress[i] + \"'].permission-status .permission-status-message\");\r\n            if (element) {\r\n                element.innerHTML = '<em>' + message + '</em>';\r\n            }\r\n        }\r\n    },\r\n\r\n\r\n    /**\r\n     * End the permission checking using an object to convey status and a message\r\n     * @param {status: int, message:string} obj \r\n     */\r\n    set_result: function (obj) {\r\n        this.last_status = obj.status;\r\n        if (obj.message) {\r\n            this.set_message(obj.message);\r\n        }\r\n\r\n        if (obj.status > 0) {\r\n            this.end('success');\r\n        }\r\n        if (obj.status <= 0) {\r\n            this.end('failed');\r\n        }\r\n    }\r\n}","/**\r\n * Scripts for the signup block\r\n * - Load existing categories for user\r\n * - Get push permission and manage flow\r\n */\r\n\r\nimport './loader.js';\r\n\r\nwindow.OneSignal = window.OneSignal || [];\r\n\r\nwindow.OneSignal.push(function() {\r\n    \r\n    // only run setup on supported browsers\r\n    if (OneSignal.isPushNotificationsSupported()) {\r\n\r\n            \r\n        /**\r\n         * Pre-check categories the user is already subscribed to \r\n         * @param string container_class    Class for containers that have category checkboxes inside them (all checkboxes in these containers will be considered for pre-checking)   \r\n         * @param {key: 0|1} tags           The tags (by key) with a 1 or a 0 (pre-checked or not pre-checked)\r\n         */\r\n        OneSignal.precheck_existing_tags = function (container_class, tags) {\r\n            // return if no tags to pre-check\r\n            if (!tags) {\r\n                return;\r\n            }\r\n\r\n            // get all the container elements\r\n            let elements = document.getElementsByClassName(container_class);\r\n        \r\n            // go through all container elements\r\n            for(let i = 0; i < elements.length; i++) {\r\n        \r\n                // get all checkboxes in the container\r\n                let checkboxes = elements[i].querySelectorAll('input[type=\"checkbox\"]');\r\n\r\n                // if a passed tag matches the checkbox, use the passed tag value for the checkbox\r\n                for (let box = 0; box < checkboxes.length; box++) {\r\n                    if (tags.hasOwnProperty(checkboxes[box].value)) {\r\n                        checkboxes[box].checked = parseInt(tags[checkboxes[box].value]);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        \r\n\r\n        // pre-check categories existing subscribers have signed up for\r\n        OneSignal.isPushNotificationsEnabled().then(function(isEnabled) {   \r\n            if (!isEnabled) {\r\n                return;\r\n            }\r\n            \r\n            OneSignal.getTags().then(function(tags) {\r\n                OneSignal.precheck_existing_tags('wp-block-push-notification-signup', tags);            \r\n            });\r\n        });\r\n\r\n\r\n        // add button event handler to submit tags when signup buttons are clicked\r\n        let buttons = document.querySelectorAll('.push-notification-signup .wp-block-button__link');\r\n        for (let i =0; i < buttons.length; i++) {\r\n\r\n            /**\r\n             * Event handler for submitting events\r\n             * @param {*} event \r\n             */\r\n            let submit_event = function (event) {\r\n\r\n                // start the loading icon and set the loadin gmessage\r\n                Push_Category_Loader.start(event.target);\r\n                Push_Category_Loader.set_message('Click \"allow\" to enable notifications.');\r\n                \r\n                // find parent with container ID\r\n                let container = event.target;\r\n                while ( ! container.classList.contains('wp-block-push-notification-signup')) {\r\n                    container = container.parentNode;\r\n                }\r\n\r\n                // all the checkboxes we want to submit\r\n                let checkboxes = container.querySelectorAll('input[type=\"checkbox\"]');\r\n\r\n                // final data to submit\r\n                let data = {};\r\n\r\n                // add checkbox values to data\r\n                for (let box = 0; box < checkboxes.length; box++) {\r\n                    data[checkboxes[box].value] = checkboxes[box].checked ? 1 : 0;\r\n                }\r\n\r\n                // send tags to OneSignal\r\n                OneSignal.sendTags(data).then(function (tags) {\r\n                    // pre-check all tag checkboxes anywhere on the page (in case there are multiple signup blocks in different places)\r\n                    OneSignal.precheck_existing_tags('wp-block-push-notification-signup', tags);\r\n                });\r\n\r\n                // if permission takes too long, show a helpful message\r\n                let permission_timeout = setTimeout (function () {\r\n                    Push_Category_Loader.set_message(\"If you don't see a popup to allow notifications, try clicking the padlock to the left of the URL or look for a notification icon (sometimes a bell or text bubble).\");\r\n                }, 10000);\r\n\r\n            \r\n                // request permissions\r\n                Notification.requestPermission().then(function (permission) {\r\n\r\n                    // stop the timer for permission process\r\n                    clearTimeout(permission_timeout);\r\n\r\n                    // permission denied\r\n                    if (permission == 'denied') {\r\n                        Push_Category_Loader.set_result({\r\n                            status: 0,\r\n                            message: 'Notifications are blocked - try clicking the padlock next to the URL to allow them.'\r\n                        });\r\n                    }\r\n\r\n                    // permission granted\r\n                    else if (permission == 'granted') {\r\n                        \r\n                        // new signup\r\n                        if (Push_Category_Loader.last_status < 1) {    \r\n                            Push_Category_Loader.set_result({\r\n                                status: 1,\r\n                                message: 'Successfully signed up for notifications'\r\n                            });\r\n                        }\r\n\r\n                        // existing subscription update\r\n                        else {\r\n                            Push_Category_Loader.set_result({\r\n                                status: 1,\r\n                                message: 'Subscription updated'\r\n                            });\r\n                        }\r\n\r\n                        // set the subscription to false if no category tags were selected, true if any were\r\n                        let any_tag_subscribed = false;\r\n                        for (const tag_checkbox in data) {\r\n                            if (data[tag_checkbox] != 0) {\r\n                                any_tag_subscribed = true;\r\n                            }\r\n                        }\r\n                        OneSignal.setSubscription(any_tag_subscribed);\r\n                    }\r\n\r\n                    // no action taken\r\n                    else if (permission == 'default') {\r\n                        Push_Category_Loader.set_result({\r\n                            status: -1,\r\n                            message: 'You must click \"allow\" in your browser to enable notifications (click the signup button to try again)'\r\n                        });\r\n                    }\r\n                });\r\n\r\n            };\r\n\r\n            // initialize the loader on the button with the containers for the icon and message\r\n            Push_Category_Loader.init(buttons[i], buttons[i].parentNode, buttons[i].parentNode.parentNode);\r\n\r\n            // handle clicks on the submit button\r\n            buttons[i].addEventListener('click', submit_event);\r\n        }\r\n    }\r\n  });\r\n\r\n"],"sourceRoot":""}